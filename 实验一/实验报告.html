
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>实验报告 ·  呼吸君のGitBook </title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Bre Athy">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-lightbox/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="过程.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.zhihu.com/people/you-yi-shi-de-hu-xi/activities" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="要求.html">
            
                <a href="要求.html">
            
                    
                    实验一
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.1" data-path="过程.html">
            
                <a href="过程.html">
            
                    
                    实验过程
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.1.2" data-path="实验报告.html">
            
                <a href="实验报告.html">
            
                    
                    实验报告
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3" >
            
                <span>
            
                    
                    参考资料
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.3.1" data-path="资料/nice.html">
            
                <a href="资料/nice.html">
            
                    
                    nice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3.2" data-path="资料/task_struct.html">
            
                <a href="资料/task_struct.html">
            
                    
                    task_struct
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../实验二/过程.html">
            
                <a href="../实验二/过程.html">
            
                    
                    实验二
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >实验报告</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <html><head></head><body><h1 id="&#x5B9E;&#x9A8C;&#x4E00;-linux&#x5185;&#x6838;&#x7F16;&#x8BD1;&#x53CA;&#x6DFB;&#x52A0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;">&#x5B9E;&#x9A8C;&#x4E00; Linux&#x5185;&#x6838;&#x7F16;&#x8BD1;&#x53CA;&#x6DFB;&#x52A0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</h1>
<h3 id="&#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x548C;&#x5185;&#x5BB9;&#x8981;&#x6C42;">&#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x548C;&#x5185;&#x5BB9;&#x8981;&#x6C42;</h3>
<h4 id="1&#x8BBE;&#x8BA1;&#x76EE;&#x7684;">1.&#x8BBE;&#x8BA1;&#x76EE;&#x7684;</h4>
<p> Linux&#x662F;&#x5F00;&#x6E90;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x8EAB;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x88C1;&#x526A;&#x3001;&#x4FEE;&#x6539;&#x5185;&#x6838;&#xFF0C;&#x5B9A;&#x5236;&#x51FA;&#x529F;&#x80FD;&#x66F4;&#x52A0;&#x5408;&#x9002;&#x3001;&#x8FD0;&#x884C;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x7F16;&#x8BD1; Linux&#x5185;&#x6838;&#x662F;&#x8FDB;&#x884C;&#x5185;&#x6838;&#x5F00;&#x53D1;&#x7684;&#x5FC5;&#x8981;&#x57FA;&#x672C;&#x529F;&#x3002;&#x5728;&#x7CFB;&#x7EDF;&#x4E2D;&#x6839;&#x636E;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x662F;&#x4FEE;&#x6539;&#x5185;&#x6838;&#x7684;&#x4E00;&#x79CD;&#x5E38;&#x7528;&#x624B;&#x6BB5;&#xFF0C;&#x901A;&#x8FC7;&#x672C;&#x6B21;&#x5B9E;&#x9A8C;&#xFF0C;&#x8BFB;&#x8005;&#x5E94;&#x7406;&#x89E3; Linux&#x7CFB;&#x7EDF;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x6D41;&#x7A0B;&#x4EE5;&#x53CA;&#x589E;&#x52A0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="2&#x5185;&#x5BB9;&#x8981;&#x6C42;">2.&#x5185;&#x5BB9;&#x8981;&#x6C42;</h4>
<h5 id="&#xFF08;1&#xFF09;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;nice&#x7684;&#x4FEE;&#x6539;&#x6216;&#x8BFB;&#x53D6;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8FDB;&#x7A0B;&#x6700;&#x65B0;&#x7684;nice&#x503C;&#x53CA;&#x4F18;&#x5148;&#x7EA7;prio&#x3002;&#x5EFA;&#x8BAE;&#x8C03;&#x7528;&#x539F;&#x578B;&#x4E3A;">&#xFF08;1&#xFF09;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;nice&#x7684;&#x4FEE;&#x6539;&#x6216;&#x8BFB;&#x53D6;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8FDB;&#x7A0B;&#x6700;&#x65B0;&#x7684;nice&#x503C;&#x53CA;&#x4F18;&#x5148;&#x7EA7;prio&#x3002;&#x5EFA;&#x8BAE;&#x8C03;&#x7528;&#x539F;&#x578B;&#x4E3A;</h5>
<pre><code class="lang-shell"> int mysetnice&#xFF08;pid_t pid&#xFF0C; int flag&#xFF0C; t nicevalue&#xFF0C;
 void _user&#xFF0A; prio&#xFF0C; void _user&#xFF0A;nice&#xFF09;&#xFF1B;
</code></pre>
<p>&#x53C2;&#x6570;&#x542B;&#x4E49;:
id:&#x8FDB;&#x7A0B;ID
flag:&#x82E5;&#x503C;&#x4E3A;0&#xFF0C;&#x5219;&#x8868;&#x793A;&#x8BFB;&#x53D6;nice&#x503C;&#xFF1B;&#x82E5;&#x503C;&#x4E3A;1&#xFF0C;&#x5219;&#x8868;&#x793A;&#x4FEE;&#x6539;nice&#x503C;&#x3002;
 nicevalue:&#x4E3A;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x8BBE;&#x7F6E;&#x7684;&#x65B0;rice&#x503C;&#x3002;
prio&#x3001;nice:&#x6307;&#x5411;&#x8FDB;&#x7A0B;&#x5F53;&#x524D;&#x4F18;&#x5148;&#x7EA7;&#x53CA;nice&#x503C;&#x3002;
&#x8FD4;&#x56DE;&#x503C;:&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6210;&#x529F;&#x65F6;&#x8FD4;&#x56DE;0&#xFF1B;&#x5931;&#x8D25;&#x65F6;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7801; EFAULT&#x3002;</p>
<h5 id="&#xFF08;2&#xFF09;&#x5199;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6D4B;&#x8BD5;&#xFF08;1&#xFF09;&#x4E2D;&#x6DFB;&#x52A0;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;">&#xFF08;2&#xFF09;&#x5199;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6D4B;&#x8BD5;&#xFF08;1&#xFF09;&#x4E2D;&#x6DFB;&#x52A0;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</h5>
<h5 id="&#xFF08;3&#xFF09;&#x82E5;&#x7A0B;&#x5E8F;&#x4E2D;&#x8C03;&#x7528;&#x4E86;-linux&#x7684;&#x5185;&#x6838;&#x51FD;&#x6570;&#xFF0C;&#x8981;&#x6C42;&#x6DF1;&#x5165;&#x9605;&#x8BFB;&#x76F8;&#x5173;&#x51FD;&#x6570;&#x6E90;&#x7801;&#x3002;">&#xFF08;3&#xFF09;&#x82E5;&#x7A0B;&#x5E8F;&#x4E2D;&#x8C03;&#x7528;&#x4E86; Linux&#x7684;&#x5185;&#x6838;&#x51FD;&#x6570;&#xFF0C;&#x8981;&#x6C42;&#x6DF1;&#x5165;&#x9605;&#x8BFB;&#x76F8;&#x5173;&#x51FD;&#x6570;&#x6E90;&#x7801;&#x3002;</h5>
<h3 id="&#x5B9E;&#x9A8C;&#x6B65;&#x9AA4;">&#x5B9E;&#x9A8C;&#x6B65;&#x9AA4;</h3>
<h4 id="1-&#x5B9E;&#x9A8C;&#x73AF;&#x5883;">1. &#x5B9E;&#x9A8C;&#x73AF;&#x5883;</h4>
<p>CentOS 7 64&#x4F4D;&#xFF0C;&#x5F85;&#x7F16;&#x8BD1;&#x7684;&#x5185;&#x6838;&#x662F; linux5.0.6.tar.xz&#x3002;</p>
<p>&#x865A;&#x62DF;&#x673A;&#xFF1A;VMware Workstation Pro 15</p>
<h4 id="2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;&#x5185;&#x6838;&#x6E90;&#x7801;">2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;&#x5185;&#x6838;&#x6E90;&#x7801;</h4>
<p>&#x5B98;&#x65B9;&#x7F51;&#x7AD9;&#x4E0A;&#x4E0B;&#x8F7D;&#x592A;&#x6162;&#xFF0C;&#x6211;&#x5728;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x6E90;&#x4E0A;&#x627E;&#x5230;&#x4E86;&#x76F8;&#x540C;&#x7684;&#x5185;&#x6838;&#x7248;&#x672C;&#xFF0C;&#x4F7F;&#x7528;<code>wget</code>&#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#xFF1A;</p>
<pre><code class="lang-shell">wget https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.0.6.tar.xz
</code></pre>
<p>&#x89E3;&#x538B;&#xFF1A;</p>
<pre><code class="lang-shell">xz -d linux-5.0.6.tar.xz
tar xvf linux-5.0.6.tar
</code></pre>
<p><a href="https://i.loli.net/2019/04/09/5caca9d12d463.png" data-lightbox="d876f5b9-f49b-4030-b126-bc003bddb2fd" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/09/5caca9d12d463.png" alt=""></a></p>
<h4 id="3-&#x914D;&#x7F6E;&#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x73AF;&#x5883;">3. &#x914D;&#x7F6E;&#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x73AF;&#x5883;</h4>
<p>&#x5B89;&#x88C5;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>yum</code>&#x547D;&#x4EE4;&#xFF0C;&#x5206;&#x522B;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;<code>ncurses-devel</code>,<code>gcc</code>,<code>flex</code>,<code>bison</code>,<code>openssl-devel</code>,<code>elfutils-libelf-devel</code>.&#x3002;</p>
<pre><code class="lang-shell">yum -y install ncurses-devel
yum -y install gcc
yum -y install flex
yum -y install bison
yum -y install openssl-devel
yum -y install elfutils-libelf-devel
</code></pre>
<p><a href="https://i.loli.net/2019/04/09/5cacab63653ff.png" data-lightbox="bd95c058-55d0-4d6a-867f-89b457164299" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/09/5cacab63653ff.png" alt=""></a></p>
<h4 id="4-&#x6E05;&#x7406;&#x6B8B;&#x7559;&#x7684;&#x6587;&#x4EF6;">4. &#x6E05;&#x7406;&#x6B8B;&#x7559;&#x7684;&#x6587;&#x4EF6;</h4>
<p>&#x4F7F;&#x7528; <code>make clean</code>,&#x548C; <code>make mrprproer</code>&#x90FD;&#x884C;</p>
<pre><code class="lang-shell">rm -f linux-5.0.6.tar
cd linux-5.0.6
make clean
</code></pre>
<h4 id="5-&#x914D;&#x7F6E;&#x5185;&#x6838;">5. &#x914D;&#x7F6E;&#x5185;&#x6838;</h4>
<p>&#x5982;&#x679C;&#x63A5;&#x4E0B;&#x6765;&#x662F; <code>make bzImage</code>,&#x5C31;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E0B;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x3002;&#x4F46;&#x8FD9;&#x91CC;&#x4E0D;&#x7528;&#xFF0C;&#x76F4;&#x63A5; <code>save</code> &#x540E; <code>exit</code>&#x5373;&#x53EF;&#x3002;</p>
<p><a href="https://i.loli.net/2019/04/09/5cacad0a2f999.png" data-lightbox="c603438c-6d46-47c7-abf4-f23cf817433d" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/09/5cacad0a2f999.png" alt=""></a></p>
<p>&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x62CD;&#x4E00;&#x5F20;&#x5FEB;&#x7167;&#xFF0C;&#x56E0;&#x4E3A;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x8981;&#x6DFB;&#x52A0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>
<h4 id="6-&#x5206;&#x914D;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53F7;">6. &#x5206;&#x914D;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53F7;</h4>
<p><code>cd</code>&#x5230;<code>arch/x86/entry/syscalls/syscall</code>,&#x6253;&#x5F00;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8868;&#xFF0C;&#x6839;&#x636E;&#x89C4;&#x5F8B;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#xFF1A;</p>
<pre><code>335     common  alternice               __x64_sys_alternice
</code></pre><p><a href="https://i.loli.net/2019/04/09/5cacaeec8ac0d.png" data-lightbox="2c5b6d81-ad83-470a-bd89-0051280a11e3" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/09/5cacaeec8ac0d.png" alt=""></a></p>
<h4 id="7-&#x7533;&#x660E;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4F8B;&#x7A0B;&#x539F;&#x578B;">7. &#x7533;&#x660E;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4F8B;&#x7A0B;&#x539F;&#x578B;</h4>
<p>&#x6253;&#x5F00;<code>syscall.h</code>&#x6DFB;&#x52A0;&#x4E00;&#x884C;</p>
<pre><code class="lang-shell">asmlinkage long sys_alternice(pid_t pid,int flag,int nicevalue,void __user*prio,void __user*nice);
</code></pre>
<p><a href="https://i.loli.net/2019/04/09/5cacb0529636a.png" data-lightbox="1918a8e4-3144-47b5-8cd2-caf568a7b0bc" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/09/5cacb0529636a.png" alt=""></a></p>
<h4 id="8&#x5B9E;&#x73B0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4F8B;&#x7A0B;">8.&#x5B9E;&#x73B0;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4F8B;&#x7A0B;</h4>
<p>&#x5728;<code>sys.c</code>&#x6587;&#x4EF6;&#x91CC;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</p>
<pre><code class="lang-shell">SYSCALL_DEFINE5(alternice,pid_t,pid,int,flag,int,nicevalue,void __user *,prio,void __user *,nice)
{
    int mprio=0;
    int mnice=0;
    int error=0;
    struct task_struct *p;
    printk(&quot;SetNice Start!\n&quot;);
    for(p=&amp;init_task;(p=next_task(p))!=&amp;init_task;)
    {
        printk(&quot;This is For CYCLE!   &quot;);
        if(p-&gt;pid==pid)
        {
            printk(&quot;Pointer GO!&quot;);
            if(flag==0)
            {
                printk(&quot;Flag == 0\n&quot;);
                mprio=task_prio(p);
                mnice=task_nice(p);
                copy_to_user(prio,&amp;mprio,sizeof(task_prio(p)));
                copy_to_user(nice,&amp;mnice,sizeof(task_nice(p)));
            }else if(flag==1)
            {
                printk(&quot;Flag == 1\n&quot;);
                set_user_nice(p,nicevalue);
                mprio=task_prio(p);
                mnice=task_nice(p);
                copy_to_user(nice,&amp;mnice,sizeof(task_nice(p)));
                copy_to_user(prio,&amp;mprio,sizeof(task_prio(p)));
            }else
            {
                printk(&quot;Flag == Nothing\n&quot;);
                error=-EFAULT;
            }
            printk(&quot;Pointer END!  \n&quot;);
            return error;
        }
    }
    printk(&quot;The system calls    BUG!!!!!!!\n    &quot;);
    error=-EFAULT;
    return error;
}
</code></pre>
<h4 id="9-&#x5F00;&#x59CB;&#x7F16;&#x8BD1;&#x5185;&#x6838;">9. &#x5F00;&#x59CB;&#x7F16;&#x8BD1;&#x5185;&#x6838;</h4>
<p>&#x6211;&#x8BBE;&#x7F6E;&#x4E86;&#x865A;&#x62DF;&#x673A;&#x56DB;&#x4E2A;&#x5185;&#x6838;&#xFF0C;&#x6240;&#x4EE5;&#x8F93;&#x5165;<code>make -j4</code></p>
<p><a href="https://i.loli.net/2019/04/10/5cad727920236.png" data-lightbox="a9782bc9-d0e2-4288-8c82-59153b308a36" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cad727920236.png" alt=""></a></p>
<h4 id="10-&#x6A21;&#x5757;&#x7F16;&#x8BD1;&#x5B89;&#x88C5;&#x4E0E;&#x5185;&#x6838;&#x5B89;&#x88C5;">10. &#x6A21;&#x5757;&#x7F16;&#x8BD1;&#x5B89;&#x88C5;&#x4E0E;&#x5185;&#x6838;&#x5B89;&#x88C5;</h4>
<pre><code class="lang-shell">make modules
make modules_install
make install
</code></pre>
<p><a href="https://i.loli.net/2019/04/10/5cad774b782a0.png" data-lightbox="ababde0d-5092-4eec-a2b6-ba3f65dba21a" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cad774b782a0.png" alt=""></a></p>
<h4 id="11&#x8BBE;&#x7F6E;&#x5F00;&#x673A;&#x5F15;&#x5BFC;&#x5E76;&#x91CD;&#x542F;">11.&#x8BBE;&#x7F6E;&#x5F00;&#x673A;&#x5F15;&#x5BFC;&#x5E76;&#x91CD;&#x542F;</h4>
<pre><code class="lang-shell">grub2-mkconfig -o /etc/grub2.cfg
grub2-set-default 0
reboot
</code></pre>
<p>&#x91CD;&#x542F;&#x5B8C;&#x8F93;&#x5165;<code>uname -r</code>&#x67E5;&#x770B;&#x5F53;&#x524D;&#x5185;&#x6838;&#x7248;&#x672C;&#x3002;</p>
<p><a href="https://i.loli.net/2019/04/10/5cad79d512e0d.png" data-lightbox="b717f0f3-304d-4a92-98fa-edcfec85cb94" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cad79d512e0d.png" alt=""></a></p>
<p>&#x53D1;&#x73B0;&#x66F4;&#x65B0;&#x5230;&#x4E86;5.0.6&#x8BC1;&#x660E;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x51FA;&#x9519;&#x3002;</p>
<h4 id="12&#x7F16;&#x5199;&#x7528;&#x6237;&#x6001;&#x7A0B;&#x5E8F;&#x6D4B;&#x8BD5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;">12.&#x7F16;&#x5199;&#x7528;&#x6237;&#x6001;&#x7A0B;&#x5E8F;&#x6D4B;&#x8BD5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</h4>
<p>&#x8FD9;&#x4E00;&#x6B65;&#x53EF;&#x4EE5;&#x5728;&#x865A;&#x62DF;&#x673A;&#x5916;&#x7F16;&#x5199;&#xFF0C;&#x7136;&#x540E;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x5185;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;demo: <code>mySyscall.c</code></p>
<pre><code class="lang-shell">#include&lt;linux/unistd.h&gt;
#include&lt;sys/syscall.h&gt;
#include&lt;stdio.h&gt;

int main()
{
    int nice = 0;
    int prio = 0;
    int flag = 0;
    int pid = 0;
    int nicevalue = 0;
    printf(&quot;&#x8BF7;&#x8F93;&#x5165; PID:&quot;);
    scanf(&quot;%d&quot;,&amp;pid);
    printf(&quot;&#x8981;&#x6539;&#x53D8;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684; nice &#x503C;&#x5417;? &#x662F;(1) , &#x5426;(0)\n&quot;);
    printf(&quot;&#x8BF7;&#x8F93;&#x5165;:&quot;);
    scanf(&quot;%d&quot;,&amp;flag);
    if(flag==0)
    {
        if(syscall(335,pid,0,0,&amp;prio,&amp;nice)==0)
        {
            printf(&quot;&#x5F53;&#x524D; nice :%d,&#x5F53;&#x524D;  prio :%d&quot;,nice,prio);
            return 0;
        }else
        {
            printf(&quot;\n&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x9519;&#x8BEF;&#xFF0C;&#x8BF7;&#x68C0;&#x67E5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF01;\n\n&quot;);
            return -1;
        }
    }else if(flag==1)
    {
        printf(&quot;&#x8BF7;&#x8F93;&#x5165;&#x4E00;&#x4E2A; nice &#x503C;:\n&quot;);
        scanf(&quot;%d&quot;,&amp;nicevalue);
        syscall(335,pid,0,0,&amp;prio,&amp;nice);
        printf(&quot;\n\n&#x539F;&#x6765;&#x7684; nice &#x503C;:%d\n&quot;,nice);
        syscall(335,pid,1,nicevalue,&amp;prio,&amp;nice);
        printf(&quot;&#x5F53;&#x524D;&#x7684; nice &#x503C;:%d\n\n\n&quot;,nice);
        return 0;
    }else
    {
        printf(&quot;&#x8F93;&#x5165;&#x65E0;&#x6548;&#xFF01;\n&quot;);
        return 0;
    }
}
</code></pre>
<p>&#x7F16;&#x8BD1;&#x5B8C;&#x6210;&#xFF1A;</p>
<p><a href="https://i.loli.net/2019/04/10/5cada28e5ec96.png" data-lightbox="4081af54-a83b-4bfc-8c62-5adcbb255105" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cada28e5ec96.png" alt=""></a></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7EC8;&#x7AEF;&#xFF0C;&#x8F93;&#x5165; <code>top</code> &#x67E5;&#x770B; &#x4E00;&#x4E2A;&#x4F8B;&#x7A0B;&#xFF08;&#x6BD4;&#x5982; top&#xFF09;&#x7684; NI &#x503C; &#x548C; PR&#x503C;&#x3002;</p>
<p><a href="https://i.loli.net/2019/04/10/5cada3131f98e.png" data-lightbox="8c9807e5-e3a7-4606-8c54-196ba81d372d" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cada3131f98e.png" alt=""></a></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230; top &#x7684;</p>
<pre><code class="lang-sh">PID = 10796
PR = 20
NI = 0
</code></pre>
<p>&#x6211;&#x4EEC;&#x8FD0;&#x884C; <code>a.out</code>&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p><a href="https://i.loli.net/2019/04/10/5cada38a500bc.png" data-lightbox="86160bb6-5198-44ec-903f-abc8581ca99b" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cada38a500bc.png" alt=""></a></p>
<p>&#x6210;&#x529F;&#x5C06;&#x5176;&#x4FEE;&#x6539;&#xFF1A;</p>
<pre><code class="lang-shell">PID = 10796
PR = 22
NI = 2
</code></pre>
<p>&#x518D;&#x6D4B;&#x8BD5;&#x51E0;&#x6B21;&#xFF1A;</p>
<p><a href="https://i.loli.net/2019/04/10/5cada42cdbc9d.png" data-lightbox="1197e171-59f1-49de-bf23-1e63f6de84db" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cada42cdbc9d.png" alt=""></a></p>
<p>&#x6CA1;&#x6709;&#x62A5;&#x9519;&#xFF0C;&#x68C0;&#x67E5; <code>dmesg</code>,&#x67E5;&#x770B;</p>
<p><a href="https://i.loli.net/2019/04/10/5cada48c2e941.png" data-lightbox="c8849227-d4b4-40cd-9e05-90ebd597eb30" data-title="" target="_blank"><img src="https://i.loli.net/2019/04/10/5cada48c2e941.png" alt=""></a></p>
<p>&#x4E5F;&#x65E0;&#x9519;&#x8BEF;&#x3002;&#x6210;&#x529F;&#x8C03;&#x7528;&#x4E86;&#x81EA;&#x5DF1;&#x6DFB;&#x52A0;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF01;</p>
<h4 id="13-&#x5B9E;&#x9A8C;&#x603B;&#x7ED3;">13. &#x5B9E;&#x9A8C;&#x603B;&#x7ED3;</h4>
<p>&#x5728;&#x6BCF;&#x6B21;&#x5B9E;&#x9A8C;&#x65F6;&#x591A;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x6BCF;&#x4E00;&#x6B65;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8BE6;&#x7EC6;&#x8C03;&#x67E5;&#x6BCF;&#x4E00;&#x6B65;&#x7684;&#x539F;&#x56E0;&#x3002;&#x5BF9;&#x4E8E;&#x5173;&#x952E;&#x6B65;&#x9AA4;&#x6709;&#x5FC5;&#x8981;&#x63D2;&#x5165;&#x5927;&#x91CF;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x865A;&#x5FC3;&#x6C42;&#x6559;&#x3002;&#x6700;&#x540E;&#x7684;&#x6210;&#x529F;&#x503C;&#x5F97;&#x559C;&#x60A6;&#xFF01;</p>
<p>&#x5B9E;&#x9A8C;&#x8FDB;&#x884C;&#x4E86;&#x591A;&#x6B21;&#xFF0C;&#x6211;&#x751A;&#x81F3;&#x81EA;&#x5DF1;&#x5199;&#x4E86;&#x4E00;&#x6BB5;&#x5C0F;Shell&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x591A;&#x6B21;&#x5B9E;&#x9A8C;&#xFF0C;&#x8FD9;&#x5BF9;&#x6211;&#x5728;&#x5B9E;&#x9A8C;&#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x4E86;&#x83AB;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#xFF1A;</p>
<pre><code class="lang-shell">cd ~
echo &quot;&#x5F00;&#x59CB;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x5939;src&quot; &gt;&gt; /root/log.txt
mkdir src
echo &quot;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x5939; src &#x5B8C;&#x6210;&#xFF01;&quot; &gt;&gt; /root/log.txt
cd src
echo &quot;&#x6B63;&#x5728;&#x4E0B;&#x8F7D;&#x5185;&#x6838; 5.0.6&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#x4F60;&#x7684;&#x673A;&#x578B;&#x662F; CentOS7.X !&quot; &gt;&gt; /root/log.txt
wget https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.0.6.tar.xz
echo &quot;&#x89E3;&#x538B;&#x5185;&#x6838;&#x6587;&#x4EF6;&quot; &gt;&gt; /root/log.txt
xz -d linux-5.0.6.tar.xz
tar xvf linux-5.0.6.tar
echo &quot;&#x89E3;&#x538B;&#x5B8C;&#x6210;&#xFF01;&quot; &gt;&gt; /root/log.txt
echo &quot;&#x5F00;&#x59CB;&#x4E0B;&#x8F7D;&#x6240;&#x9700;&#x5B89;&#x88C5;&#x5305;......&quot; &gt;&gt; /root/log.txt
yum -y install ncurses-devel
echo &quot;&#x7B2C;&#x4E00;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
yum -y install gcc
echo &quot;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
yum -y install flex
echo &quot;&#x7B2C;&#x4E09;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
yum -y install bison
echo &quot;&#x7B2C;&#x56DB;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
yum -y install openssl-devel
echo &quot;&#x7B2C;&#x4E94;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
yum -y install elfutils-libelf-devel
echo &quot;&#x7B2C;&#x516D;&#x4E2A;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
echo &quot;&#x5B89;&#x88C5;&#x5DE5;&#x4F5C;&#x7ED3;&#x675F;&#xFF01;&#x5F00;&#x59CB;&#x6E05;&#x7406;&#x5783;&#x573E;&#x6587;&#x4EF6;...&quot; &gt;&gt; /root/log.txt
rm -f linux-5.0.6.tar
cd linux-5.0.6
make clean
echo &quot;&#x6E05;&#x7406;&#x5B8C;&#x6210;&#xFF01;&#x6240;&#x6709;&#x5DE5;&#x4F5C;&#x7ED3;&#x675F;&#xFF01;&#xFF01;&#xFF01;&#x611F;&#x8C22;&#x4F7F;&#x7528;&#xFF01;&quot; &gt;&gt; /root/log.txt
echo &quot;&#x68C0;&#x67E5;&#x65E5;&#x5FD7;:&quot;
history -c
cat /root/log.txt
make menuconfig


cd ~/src/linux-5.0.6.tar/
make -j4
echo &quot;&#x5185;&#x6838;&#x7F16;&#x8BD1;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
make modules
echo &quot;&#x6A21;&#x5757;&#x7F16;&#x8BD1;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
make modules_install
echo &quot;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
make install
echo &quot;&#x5185;&#x6838;&#x5B89;&#x88C5;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
grub2-mkconfig -o /etc/grub2.cfg
echo &quot;grub &#x5F15;&#x5BFC;&#x5B8C;&#x6210;...&quot; &gt;&gt; /root/log.txt
grub2-set-default 0
history -c
echo &quot;&#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x9879;&#x5B8C;&#x6210;...&#x5F00;&#x59CB;&#x91CD;&#x542F;&quot; &gt;&gt; /root/log.txt
reboot
</code></pre>
<p>&#x6700;&#x540E;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#x5566;&#xFF01;</p>

<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style></body></html>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="过程.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 实验过程">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"实验报告","level":"1.1.1.2","depth":3,"next":{"title":"参考资料","level":"1.1.1.3","depth":3,"ref":"","articles":[{"title":"nice","level":"1.1.1.3.1","depth":4,"path":"实验一/资料/nice.md","ref":"实验一/资料/nice.md","articles":[]},{"title":"task_struct","level":"1.1.1.3.2","depth":4,"path":"实验一/资料/task_struct.md","ref":"实验一/资料/task_struct.md","articles":[]}]},"previous":{"title":"实验过程","level":"1.1.1.1","depth":3,"path":"实验一/过程.md","ref":"实验一/过程.md","articles":[]},"dir":"ltr"},"config":{"plugins":["donate","chapter-fold","back-to-top-button","code","-lunr","-search","search-pro","splitter","-sharing","sharing-plus","popup","lightbox","livereload"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"pluginsConfig":{"chapter-fold":{}},"livereload":{},"splitter":{},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"popup":{},"code":{"copyButtons":true},"donate":{"alipay":"https://ws3.sinaimg.cn/large/005BYqpgly1g2chablu88g30c90c9e81.jpg","alipayText":"更多精彩","button":"提问","title":"","wechat":"https://ws3.sinaimg.cn/large/005BYqpgly1g2chnfd4c2g309i09ikcz.jpg","wechatText":"QQ 提问"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"lightbox":{"jquery":true},"back-to-top-button":{},"sharing":{"qq":true,"all":["douban","facebook","google","instapaper","linkedin","twitter","weibo","messenger","qq","qzone","viber","whatsapp"],"douban":false,"facebook":false,"weibo":true,"twitter":false,"pocket":false,"google":true,"qzone":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Bre Athy","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":" 呼吸君のGitBook ","language":"zh-hans","links":{"sidebar":{"Home":"https://www.zhihu.com/people/you-yi-shi-de-hu-xi/activities"}},"gitbook":"*","description":"Linux实验"},"file":{"path":"实验一/实验报告.md","mtime":"2019-04-10T08:19:43.843Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-25T06:28:13.722Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/lightbox.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

